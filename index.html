<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dungeon</title>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>

<body>
    <h1>The page is alive.</h1>

    <canvas id="game" width="640" height="480" style="border:2px solid red;"></canvas>

    <link rel="stylesheet" href="https://pyscript.net/unstable/pyscript.css" />
    <script defer src="https://pyscript.net/unstable/pyscript.js"></script>

    <py-script>
from js import document, setInterval
from pyodide.ffi import create_proxy

canvas = document.getElementById("game")
ctx = canvas.getContext("2d")

# square position
x = 100
y = 100

def draw():
    global x

    # clear screen
    ctx.fillStyle = "black"
    ctx.fillRect(0, 0, canvas.width, canvas.height)

    # move square
    x = x + 1
    if x > canvas.width:
        x = -100

    # draw square
    ctx.fillStyle = "gold"
    ctx.fillRect(x, y, 100, 100)

# IMPORTANT: wrap the function
draw_proxy = create_proxy(draw)

# run ~60 times per second
setInterval(draw_proxy, 16)

    </py-script>
</body>

</html>

