<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dungeon</title>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
</head>

<body>
    <h1>The page is alive.</h1>

    <canvas id="game" width="640" height="480" style="border:2px solid red;"></canvas>

    <link rel="stylesheet" href="https://pyscript.net/unstable/pyscript.css" />
    <script defer src="https://pyscript.net/unstable/pyscript.js"></script>

    <py-script>
from js import document, setInterval
from pyodide.ffi import create_proxy

canvas = document.getElementById("game")
ctx = canvas.getContext("2d")

# square position
x = 100
y = 100
speed = 3

# keys currently held
keys = set()

def key_down(event):
    keys.add(event.key)

def key_up(event):
    keys.discard(event.key)

# wrap event handlers
key_down_proxy = create_proxy(key_down)
key_up_proxy = create_proxy(key_up)

document.addEventListener("keydown", key_down_proxy)
document.addEventListener("keyup", key_up_proxy)

def draw():
    global x, y

    # move based on input
    if "w" in keys:
        y -= speed
    if "s" in keys:
        y += speed
    if "a" in keys:
        x -= speed
    if "d" in keys:
        x += speed

    # clear screen
    ctx.fillStyle = "black"
    ctx.fillRect(0, 0, canvas.width, canvas.height)

    # draw square
    ctx.fillStyle = "gold"
    ctx.fillRect(x, y, 100, 100)

# wrap draw loop
draw_proxy = create_proxy(draw)
setInterval(draw_proxy, 16)

    </py-script>
</body>

</html>

